pipeline {
    agent any

    stages {
        stage('Docker Build') {
            steps {
                sh '''
                # docker build
                sudo docker build -t 720066329958.dkr.ecr.ap-southeast-2.amazonaws.com/static-apache:$BUILD_NUMBER .
                # login to ecr
                aws ecr get-login-password --region ap-southeast-2 | sudo docker login --username AWS --password-stdin 720066329958.dkr.ecr.ap-southeast-2.amazonaws.com

                # push the image to ecr
                sudo docker push 720066329958.dkr.ecr.ap-southeast-2.amazonaws.com/static-apache:$BUILD_NUMBER '''

            }
        }
        stage('EKS Deploy') {
            steps {
                sh '''
                # applykubectl
                kubectl apply -f .
                '''
            }
        }
         stage('validation') {
            steps {
                sh '''
                # applykubectl
                cd k8s/
                kubectl get po -A # -A for all namespace sh '''
            }
        }
    }
}